DELIMITER //

CREATE FUNCTION day_taken (id INT, start_date DATE, end_date DATE)
RETURNS BOOLEAN
BEGIN
    DECLARE finished INTEGER DEFAULT 0;
    declare temp1 DATE;
    declare temp2 date;
    declare ans BOOLEAN;

	-- declare cursor for employee email
	DEClARE curReq 
		CURSOR FOR 
			SELECT start_time, end_time FROM request WHERE status = 1 AND id_book = id;

	-- declare NOT FOUND handler
	DECLARE CONTINUE HANDLER 
        FOR NOT FOUND SET finished = 1;
    
    SET ans = false;

    OPEN curReq;
         check_day: LOOP
            FETCH curReq INTO temp1, temp2;
            IF finished = 1 THEN 
                LEAVE check_day;
            END IF;
            if (start_date >= temp1 AND start_date <= temp2) OR (end_date >= temp1 AND end_date <= temp2) then
              SET ans = true;
              LEAVE check_day;
            end if;
            SET temp1 = '';
            SET temp2 = '';
	    END LOOP check_day;
    CLOSE curReq;

    RETURN ans;
END//

DELIMITER ; 